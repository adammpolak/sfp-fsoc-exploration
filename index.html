<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FSOC SFP Simulator</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <header class="toolbar">
      <div class="brand">FSOC SFP Simulator</div>
      <button id="configToggle" class="config-toggle">Config</button>
      <div class="controls">
        <label>Bitrate
          <select id="bitrate">
            <option value="0.1">100 Mb/s</option>
            <option value="1" selected>1 Gb/s</option>
            <option value="10">10 Gb/s</option>
          </select>
        </label>
        <label>Wavelength (nm)
          <input id="wavelength" type="number" value="1550">
        </label>
        <label>Target BER
          <input id="targetBer" type="number" step="1e-12" value="1e-12">
        </label>
        <label>Weather
          <select id="weather">
            <option value="clear">Clear</option>
            <option value="haze">Haze</option>
            <option value="light_fog">Light Fog</option>
            <option value="heavy_fog">Heavy Fog</option>
          </select>
        </label>
        <label>Wind (m/s)
          <input id="windMps" type="number" step="0.5" value="5">
        </label>
        <label>Jitter Max (Hz)
          <input id="jitterMaxHz" type="number" step="1" value="1000">
        </label>
        <label>PSD Low (mrad²/Hz)
          <input id="psdLow" type="number" step="0.0001" value="0.0001">
        </label>
        <label>PSD High (mrad²/Hz)
          <input id="psdHigh" type="number" step="0.0001" value="0.00005">
        </label>
        <label>Split Hz
          <input id="psdSplitHz" type="number" step="1" value="100">
        </label>
        <label>Alignment
          <select id="alignmentMode">
            <option value="dual_lambda">Dual-λ</option>
            <option value="pilot">Pilot</option>
            <option value="retroreflector">Retroreflector</option>
            <option value="imaging">Imaging</option>
          </select>
        </label>
        <label>Align λ (nm)
          <input id="alignWavelength" type="number" value="1310">
        </label>
        <button id="importBtn">Import</button>
        <button id="exportBtn">Export</button>
        <button id="resetBtn">Reset</button>
        <button id="resetModelsBtn">Reset Models</button>
        <label>Auto Update
          <input id="autoUpdate" type="checkbox" checked>
        </label>
        <button id="runBtn">Run</button>
      </div>
    </header>
    <main class="layout">
      <!-- Mobile-first vertical layout -->
      <section class="mobile-section" id="mobile-beam-visual">
        <h3 class="section-title">Free-Space Channel</h3>
        <div id="mobileBeamVisual" class="beam-visual"></div>
        <div class="beam-controls">
          <button id="mobileBeamZoomToggle">Zoom Lens</button>
          <button id="mobileBeamJitterToggle">Play Jitter</button>
          <label class="beam-toggle"><input type="checkbox" id="mobileBeamAutoAlign" checked> Auto Align</label>
        </div>
        <div id="mobileBeamCaptureReadout" class="beam-readout">Capture: —</div>
      </section>

      <section class="mobile-section" id="mobile-tx-column">
        <h3 class="section-title">Transmitter</h3>
        <div id="mobileTxGroups" class="groups-container"></div>
      </section>

      <section class="mobile-section" id="mobile-channel-effects">
        <h3 class="section-title">Free Space Effects</h3>
        <div id="mobileChannelGroups" class="groups-container"></div>
      </section>

      <section class="mobile-section" id="mobile-rx-column">
        <h3 class="section-title">Receiver</h3>
        <div id="mobileRxGroups" class="groups-container"></div>
      </section>

      <section class="mobile-section" id="mobile-max-reach">
        <div id="mobileMaxReachExplain" class="summary-panel"></div>
      </section>

      <aside class="mobile-section" id="mobile-parts">
        <h3 class="section-title">Parts</h3>
        <input id="mobileSearchParts" placeholder="Search components">
        <div id="mobilePartsList"></div>
      </aside>

      <aside class="mobile-section" id="mobile-properties">
        <div class="props-section">
          <div class="tab-container">
            <div class="tab-header">
              <button class="tab-button active" data-tab="properties">Properties</button>
              <button class="tab-button" data-tab="metrics">Key Metrics</button>
              <button class="tab-button" data-tab="plots">Plots</button>
              <button class="tab-button" data-tab="gain">Gain / Loss</button>
            </div>
            <div class="tab-panels">
              <div id="tab-properties" class="tab-panel active">
                <div id="warnings"></div>
                <div id="inspector"></div>
              </div>
              <div id="tab-metrics" class="tab-panel">
                <div id="kpis" class="tab-section"></div>
              </div>
              <div id="tab-plots" class="tab-panel">
                <div class="plot-card">
                  <h4>Received Power vs Distance</h4>
                  <div id="prxPlot" class="plot-area"></div>
                </div>
                <div class="plot-card">
                  <h4>BER vs Distance</h4>
                  <div id="berPlot" class="plot-area"></div>
                </div>
              </div>
              <div id="tab-gain" class="tab-panel">
                <div id="stageBreakdown" class="tab-section"></div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Desktop layout (hidden on mobile) -->
      <aside class="sidebar left desktop-only">
        <h3>Parts</h3>
        <input id="searchParts" placeholder="Search components">
        <div id="partsList"></div>
      </aside>
      <section class="canvas desktop-only">
        <div id="canvasGuide">
          <p>Left: transmitter blocks. Middle: channel effects. Right: receiver blocks. Click groups/components to expand details. Click arrows to expand/collapse.</p>
        </div>
        <div id="beamCanvas" class="canvas-container">
          <div class="canvas-content">
            <div class="tx-column column">
              <h3 class="column-title">Transmitter</h3>
              <div id="txGroups" class="groups-container"></div>
            </div>
            <div class="channel-column column">
              <h3 class="column-title">Free-Space Channel</h3>
              <div id="beamVisual" class="beam-visual"></div>
              <div class="beam-controls">
                <button id="beamZoomToggle">Zoom Lens</button>
                <button id="beamJitterToggle">Play Jitter</button>
                <label class="beam-toggle"><input type="checkbox" id="beamAutoAlign" checked> Auto Align</label>
              </div>
              <div id="beamCaptureReadout" class="beam-readout">Capture: —</div>
              <div id="channelGroups" class="groups-container"></div>
            </div>
            <div class="rx-column column">
              <h3 class="column-title">Receiver</h3>
              <div id="rxGroups" class="groups-container"></div>
            </div>
          </div>
        </div>
      </section>
      <aside class="sidebar right desktop-only">
        <div class="props-section">
          <div class="tab-container">
            <div class="tab-header">
              <button class="tab-button active" data-tab="properties">Properties</button>
              <button class="tab-button" data-tab="metrics">Key Metrics</button>
              <button class="tab-button" data-tab="plots">Plots</button>
              <button class="tab-button" data-tab="gain">Gain / Loss</button>
            </div>
            <div class="tab-panels">
              <div id="tab-properties" class="tab-panel active">
                <div id="warnings"></div>
                <div id="inspector"></div>
              </div>
              <div id="tab-metrics" class="tab-panel">
                <div id="kpis" class="tab-section"></div>
              </div>
              <div id="tab-plots" class="tab-panel">
                <div class="plot-card">
                  <h4>Received Power vs Distance</h4>
                  <div id="prxPlot" class="plot-area"></div>
                </div>
                <div class="plot-card">
                  <h4>BER vs Distance</h4>
                  <div id="berPlot" class="plot-area"></div>
                </div>
              </div>
              <div id="tab-gain" class="tab-panel">
                <div id="stageBreakdown" class="tab-section"></div>
              </div>
            </div>
          </div>
        </div>
        <div id="maxReachExplain" class="summary-panel"></div>
      </aside>
    </main>
    <script src="js/calc/turbulence.js"></script>
    <script src="js/calc/pointing.js"></script>
    <script src="js/calc/ber.js"></script>
    <script src="js/calc/control.js"></script>
    <script src="js/calc/evaluator.js"></script>
    <script src="components.db.js"></script>
    <script src="app.js"></script>
  </body>
</html>
